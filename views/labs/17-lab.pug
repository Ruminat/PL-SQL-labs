- var lab_n = 17;
- var title = "Практическое занятие 17. Создание триггеров";


+lab
  +task("1", "В таблице <code>Jobs</code> хранятся значения максимально и минимально допустимой зарплаты для данной должности. Необходимо создать триггер, связанный с операциями <code>INSERT</code> и <code>UPDATE</code> таблицы <code>Employees</code>, который не позволит устанавливать некорректную зарплату для сотрудников. Для этого:")
    ul
      li Создайте процедуру <code>check_salary</code>:
        ul
          li Процедура принимает на вход 2 параметра — идентификатор должности сотрудника и величину его зарплаты. 
          li Процедура использует <code>Job ID</code> для определения максимально и минимально возможной зарплаты для этой должности (на основе данных в таблице <code>Jobs</code>). 
          li Если значение второго параметра не попадает в установленный для данной должности диапазон значений процедура должна генерировать исключение «<code>Invalid salary {sal} for this job. Salaries must be between {min} and {max}</code>». Заменяйте именованные зоны соответствующими значениями.
      li Создайте триггер <code>check_salary_trg</code> на таблицу <code>Employees</code>, который срабатывает для каждой строки перед операциями <code>INSERT</code> и <code>UPDATE</code>. 
        ul
          li Триггер должен вызывать на исполнение процедуру <code>check_salary</code>.
          li Триггер должен передавать процедуре значения <code>Job ID</code> и зарплаты.


  +task("2", "Протестируйте работу триггера.")
    ul
      li Добавьте нового сотрудника с помощью процедуры <code>emp_pkg.add_employee</code> c именем <code>Eleanor Beh</code> и номером отдела <code>30</code>. Что произойдет и почему? Какая зарплата присваивается сотруднику при добавлении?
      li Измените зарплату сотруднику <code>115</code> на <code>$2000</code>. С помощью отдельной операции измените его должность на <code>HR_REP</code>. Что произойдет и почему?
      li Измените зарплату <code>115</code> сотрудника на <code>$2800</code>. Что произойдет?

  +task("3", "Внесите изменения в триггер таким образом, чтобы он срабатывал только при фактическом изменении зарплаты или должности сотрудника. Проверять допустимость зарплаты нужно в 2 случаях — собственно при изменении зарплаты, и при изменении должности сотрудника. Почему?")
    ul
      li Добавьте в описание триггера <code>WHEN</code>-конструкцию, проверяющую, что значение в столбцах <code>Salary</code> или <code>Job_ID</code> изменилось. Убедитесь, что Вы предусмотрели ситуацию, когда прежним (<code>OLD</code>) значением было <code>NULL</code> (в каком случае это происходит?).
      li Протестируйте работу триггера с помощью процедуры <code>emp_pkg.add_employee</code> и следующим набором параметров:
        ul
          li <code>p_first_name = 'Eleanor'</code>,
          li <code>p_last_name = 'Beh'</code>,
          li <code>p_Email = 'EBEH'</code>,
          li <code>p_Job = 'IT_PROG'</code>,
          li <code>p_sal = 5000</code>.
      li Обновите зарплату сотрудников в должности <code>IT_PROG</code> — повысьте зарплату на <code>$2000</code>. Зафиксируйте результат.
      li Присвойте <code>Eleanor Beh</code> зарплату равную <code>$9000</code>.
      li Измените должность <code>Eleanor Beh</code> на <code>ST_MAN</code>. Зафиксируйте результат.

  +task("4", "Напишите триггер, запрещающий удаление сотрудников в рабочие часы.")
    ul
      li Создайте <code>statement</code> триггер с именем <code>delete_emp_trg</code> на таблицу <code>Employees</code>. Запретите удаление в период с 09:00 до 18:00. (или другой период актуальный на момент тестирования).
      li Попробуйте удалить сотрудника в должности <code>SA_REP</code>, который не приписан ни к какому отделу.