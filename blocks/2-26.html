<!DOCTYPE htmls>
<html lang="ru">
  <head>
    <title>Доп. задание 2.26</title>
    <meta charset="UTF-8"/>
    <link rel="icon" href="../img/icons/database.png"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/main.css"/>
  </head>
  <body>
    <nav id="menu"><a class="element" id="menu-switch">
        <div class="icon-part"><img class="icon" src="../img/icons/menu.png"/></div>
        <div class="text-part"></div></a><a class="element" href="../index.html">
        <div class="icon-part"><img class="icon" src="../img/icons/home.png"/></div>
        <div class="text-part">На главную</div></a><a class="element link" href="https://github.com/Ruminat/PL-SQL-labs">
        <div class="icon-part"><img class="icon" src="../img/icons/github.png"/></div>
        <div class="text-part">GitHub</div></a>
    </nav>
    <div id="main">
      <div class="labs">
        <div class="labs">
          <div class="header">
            <h1>Дополнительное задание 2.26</h1>
          </div>
        </div>
        <h2>Постановка задачи</h2>
        <p class="task-text">В таблице имеется столбец с символьными строками. Для каждой символьной строки определить подстроки, встречающиеся в символьной строке ровно два раза и содержащие наибольшее количество символов. Вывести символьные строки и номера позиций начала  подстрок.  Выделенные подстроки не должны пересекаться. Например, для символьных строк:</p><row class="aligment-center"><table class="table table-SQL table-bordered table-hover table-sm"><thead class="thead-dark"><tr><th>Строка</th></tr></thead><tbody><tr><td>Сabjrehwklhgfjrehwkyupolkoraclenmoraclepp<code>microsoft</code>m<code>microsoft</code>u<code>microsoft</code></td></tr><tr><td>yyyyyyyy</td></tr><tr><td>create</td></tr></tbody></table></row>
        <p>результат должен быть:</p><row class="aligment-center"><table class="table table-SQL table-bordered table-hover table-sm"><thead class="thead-dark"><tr><th>Строка</th><th>Подстрока</th><th>Номер позиции начала 1</th><th>Номер позиции начала 2</th></tr></thead><tbody><tr><td>сabjrehwklhgfjrehwkyupolkoraclenmoracleppmicrosoftmmicrosoftumicrosof</td><td>jrehwk</td><td>4</td><td>15</td></tr><tr><td></td><td>oracle</td><td>26</td><td>34</td></tr><tr><td>yyyyyyyy</td><td>yyyy</td><td>1</td><td>5</td></tr><tr><td>grant</td><td>-</td><td>-</td><td>-</td></tr></tbody></table></row>
        <h2>Решение</h2>
        <pre class="line-numbers undefined"><code class="language-plsql">DECLARE
  str       VARCHAR2(32767) := '(a + b)^2 = a^2 + 2ab + b^2';
  -- str       VARCHAR2(32767) := '123412314231243121342132413214321';
  -- str       VARCHAR2(32767); -- текущая строка
  substring VARCHAR2(16384); -- текущая подстрока
  len         NUMBER; -- длина строки
  maxLength   NUMBER; -- максимально возможная длина подстроки
  maxStartPos NUMBER; -- максимальная стартовая позиция подстроки
  occurrings  NUMBER; -- количество вхождений подстроки в строку
BEGIN
  -- можно ли найти в строке необходимые подстроки
  IF (str IS NULL OR LENGTH(str) < 2) THEN
    DBMS_OUTPUT.PUT_LINE('-');
  ELSE
    len := LENGTH(str);
    maxLength := FLOOR(len / 2);
    FOR currentLength IN REVERSE 1..maxLength LOOP
      -- EXIT WHEN currentLength < foundLegth;
      maxStartPos := len - currentLength + 1;
      FOR startPos IN 1..maxStartPos LOOP
        substring := SUBSTR(str, startPos, currentLength);
        occurrings := ( -- кол-во вхождений = (длина - длина_без_подстроки) / длина_подстроки
            len - LENGTH(REPLACE(LOWER(str), LOWER(substring)))
          ) / LENGTH(substring);
        CONTINUE WHEN occurrings != 2;
        DBMS_OUTPUT.PUT_LINE(
             'substring = ''' || substring
          || '''; startPos = ' || startPos
          || '; length = ' || currentLength
        );
      END LOOP;
    END LOOP;
  END IF;
END;
/</code></pre>
        <pre><code class="language-output">
            Строка                                                                | Подстрока | Номер позиции начала 1 | Номер позиции начала 2
            ----------------------------------------------------------------------|-----------|------------------------|-----------------------
            </code></pre>
      </div>
    </div>
    <script src="../js/prism.js"></script>
    <script src="../js/setup.js"></script>
    <script src="../js/main.js"></script>
  </body>
</html>