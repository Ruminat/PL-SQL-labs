<!DOCTYPE html><html lang="ru"><head><title>8. Компилятор PL/SQL</title><meta charset="UTF-8"><link rel="icon" href="./../img/icons/database.png"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous"><link rel="stylesheet" href="./../css/main.css"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"></head><body><nav id="menu"><a class="element" id="menu-switch"><div class="icon-part"><i class="fas fa-bars"></i></div><div class="text-part"></div></a><a class="element" href="../index.html"><div class="icon-part"><i class="fas fa-home"></i></div><div class="text-part">На главную</div></a><a class="element link" href="https://github.com/Ruminat/PL-SQL-labs"><div class="icon-part"><i class="fab fa-github"></i></div><div class="text-part">GitHub</div></a></nav><div id="main"><div class="header"><h2>8. Компилятор PL/SQL</h2></div><div class="section" id="secion-1"><!-- - sections.push({number: section, title: title});--><a class="section-link" id="section-1"><h4 class="section-header">1. Использование компилятора PL/SQL</h4></a></div><ul><li>PL/SQL использует новый оптимизирующий компилятор, который может переделать код для лучшей производительности.</li><li>Производительность PL/SQL улучшена по всем направлениям.</li><li>Большинство улучшений выполняются автоматически.</li><li>Уровень оптимизации по умолчанию повышает производительность для широкого диапазона PL/SQL операций.</li></ul><p>Изменения в компиляторе PL/SQL:</p><ul><li>Уничтожение временных операндов компилятором.</li><li>Вычисление некоторых операций во время компиляции.</li><li>Повторное использование значений некоторых выражений.</li><li>Упрощение или исключение некоторых ветвей и исключение мёртвого кода.</li><li>Избежание библиотечных вызовов путем прямого выполнения некоторых операций на виртуальной машине PL/SQL.</li><li>Все курсоры корректно завершаются при выходе из цикла курсора или блока объявления.</li><li>Удаление вычислений, которые, как побочный эффект, лишь вызывают исключение.</li></ul><div class="section" id="secion-2"><!-- - sections.push({number: section, title: title});--><a class="section-link" id="section-2"><h4 class="section-header">2. Параметры инициализации для компилятора PL/SQL</h4></a></div><ul><li><code class="language-plsql">PLSQL_CODE_TYPE</code>. Задаёт режим компиляции (<u><code class="language-plsql">INTERPRETED</code></u> или <code class="language-plsql">NATIVE</code>).<p>Этот параметр задает режим компиляции для модулей PL/SQL библиотек. Если вы выберете <code class="language-plsql">INTERPRETED</code>, модули PL/SQL библиотеки  будут скомпилированы в формат байт-кода PL/SQL. Такие модули выполняются интерпретатором PL/SQL. При выборе <code class="language-plsql">NATIVE</code> библиотечные модули PL/SQL (за исключением анонимных PL/SQL блоков верхнего уровня) будут скомпилированы в машинный код. Такие модули будут выполняться изначально без дополнительных затрат на интерпретатор.</p><p class="comment">При изменении значения этого параметра он не влияет на уже скомпилированные модули PL/SQL библиотеки. Значение этого параметра постоянно хранится в каждом библиотечном блоке. Если модуль PL/SQL библиотеки скомпилирован как <code class="language-plsql">NATIVE</code>, все последующие автоматические перекомпиляции этого модуля библиотеки будут использовать <code class="language-plsql">NATIVE</code>-компиляцию. В Oracle Database 11g <code class="language-plsql">NATIVE</code> компиляция проще и интегрированнее, с меньшим количеством параметров инициализации для установки.</p><p class="comment">В редких случаях, если издержки оптимизатора заставляют компиляцию очень больших приложений занимать слишком много времени, можно снизить уровень оптимизации, установив параметр инициализации <code class="language-plsql">PLSQL_OPTIMIZE_LEVEL</code> равным 1 вместо его значения по умолчанию 2. В более редких случаях может наблюдаться изменение в поведении исключения — либо исключение, которое не возникает вообще, либо исключение, которое возникает раньше, чем ожидалось. Установка <code class="language-plsql">PLSQL_OPTIMIZE_LEVEL</code> равным 0 совсем запрещает изменение кода.</p></li><li><code class="language-plsql">PLSQL_OPTIMIZE_LEVEL</code>. Задаёт уровень оптимизации (<code class="language-plsql">0</code>, <code class="language-plsql">1</code>, <u><code class="language-plsql">2</code></u> или <code class="language-plsql">3</code>).<ul><li><code class="language-plsql">0</code>. Поддерживает порядок вычислений и, следовательно, шаблоны побочных эффектов, исключений и инициализации пакетов Oracle9i и более ранних выпусков. Так же удаляет новые семантические сущности <code class="language-plsql">BINARY_INTEGER</code> и <code class="language-plsql">PLS_INTEGER</code> и восстанавливает предыдущие правила вычисления целочисленных выражений. Хотя код будет работать несколько быстрее, чем в Oracle9i, использование уровня 0 потеряет большую часть прироста производительности PL/SQL, начиная с Oracle Database 10g.</li><li><code class="language-plsql">1</code>. Применяет широкий диапазон оптимизаций к PL/SQL программам, включая устранение ненужных вычислений и исключений, но, как правило, не меняет первоначальный порядок исходного кода</li><li><u><code class="language-plsql">2</code></u>. Применяет широкий спектр современных методов оптимизации за пределами уровня 1, включая изменения, которые могут переместить исходный код относительно далеко от его первоначального местоположения</li><li><code class="language-plsql">3</code>. Новое значение, появившееся в Oracle Database 11g. Применяет широкий спектр методов оптимизации за пределами уровня 2, автоматически включая методы, не запрошенные специально. Это включает подстановку процедур, которая представляет собой процесс оптимизации, заменяющий вызовы процедур копией тела вызываемой процедуры. Скопированная процедура почти всегда выполняется быстрее, чем исходный вызов. Чтобы разрешить подпрограммную подстановку, примите значение по умолчанию параметра инициализации <code class="language-plsql">PLSQL_OPTIMIZE_LEVEL</code> (которое равно 2) или задайте для него значение 3. При <code class="language-plsql">PLSQL_OPTIMIZE_LEVEL = 2</code> необходимо указать каждую подпрограмму <code class="language-plsql">INLINE</code>. При <code class="language-plsql">PLSQL_OPTIMIZE_LEVEL = 3</code> компилятор PL/SQL ищет возможности для встраивания подпрограмм за пределы места, где они были указаны вами.</li></ul></li><li><code class="language-plsql">PLSQL_CCFLAGS</code>. Управляет условной компиляцией каждого модуля PL/SQL библиотеки независимо.</li><li><code class="language-plsql">PLSQL_WARNINGS</code>. Включает или отключает создание PL/SQL компилятором отчётов о предупреждениях.</li></ul><p>Как правило, для обеспечения максимальной производительности, используют следующий параметр:</p><pre class="line-numbers undefined"><code class="language-plsql">ALTER SESSION SET PLSQL_CODE_TYPE      = 'NATIVE';
ALTER SESSION SET PLSQL_OPTIMIZE_LEVEL = 2;
</code></pre><p>Настройки PL/SQL объектов можно посмотреть в словаре <code class="language-plsql">USER|ALL|DBA_PLSQL_OBJECT_SETTINGS</code>.</p><pre class="line-numbers undefined"><code class="language-plsql">SELECT Name, Type, PLSQL_Debug, PLSQL_Code_Type, PLSQL_Optimize_Level
FROM USER_PLSQL_OBJECT_SETTINGS;</code></pre><row class="aligment-center"><table class="table table-SQL table-bordered table-hover table-sm"><thead class="thead-dark"><tr><th>NAME</th><th>TYPE</th><th>PLSQL_DEBUG</th><th>PLSQL_CODE_TYPE</th><th>PLSQL_OPTIMIZE_LEVEL</th></tr></thead><tbody><tr><td>ADD_EMPLOYEE</td><td>PROCEDURE</td><td>FALSE</td><td>INTERPRETED</td><td>2</td></tr><tr><td>ADD_JOB_HISTORY</td><td>PROCEDURE</td><td>FALSE</td><td>INTERPRETED</td><td>2</td></tr><tr><td>CHECK_SALARY</td><td>PROCEDURE</td><td>FALSE</td><td>INTERPRETED</td><td>2</td></tr><tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><td>VALID_DEPTID</td><td>FUNCTION</td><td>FALSE</td><td>INTERPRETED</td><td>2</td></tr><tr><td>WEB_EMPLOYEE_REPORT</td><td>PROCEDURE</td><td>FALSE</td><td>INTERPRETED</td><td>2</td></tr></tbody></table></row><div class="section" id="secion-3"><!-- - sections.push({number: section, title: title});--><a class="section-link" id="section-3"><h4 class="section-header">3. Использование предупреждений при компиляции</h4></a></div><p>Преимущества предупреждений компилятора:</p><ul><li>Делают программы более надежными и помогают избежать проблем во время выполнения.</li><li>Выявление потенциальных проблем с производительностью.</li><li>Определение факторов, приводящих к неопределенным результатам.</li></ul><p>Типы предупреждений:</p><ul><li>Серьёзные (severe).</li><li>Производительности (performance).</li><li>Информационные (informational).</li><li>Все (all).</li></ul><p>Можно управлять отображением предупреждений:</p><pre class="line-numbers undefined"><code class="language-plsql">ALTER SESSION SET plsql_warnings = 'error:severe'
                                 , 'enable:performance'
                                 , 'disable:informational'
                                 , 'error:05003'; -- 05003 — код предупреждения
</code></pre><p>В SQL*Plus просмотреть ошибки можно с помощью команды <code class="language-plsql">SHOW ERRORS;</code>.</p><p>Рекомендации по использованию <code class="language-plsql">PLSQL_WARNINGS</code>:</p><ul><li>Настройки параметра <code class="language-plsql">PLSQL_WARNINGS</code> хранятся с каждой компилируемой подпрограммой.</li><li>Если перекомпилировать подпрограмму с помощью одной из следующих инструкций, будут использованы текущие настройки для этого сеанса:<ul> <li><code class="language-plsql">CREATE OR REPLACE</code>.</li><li><code class="language-plsql">ALTER ... COMPILE</code>.</li></ul></li><li>Если перекомпилировать подпрограмму с помощью инструкции <code class="language-plsql">ALTER ... COMPILE</code> с разделом <code class="language-plsql">REUSE SETTINGS</code>, то будут использованы исходные установки, сохранённые с программой.</li></ul><div class="section" id="secion-4"><!-- - sections.push({number: section, title: title});--><a class="section-link" id="section-4"><h4 class="section-header">4. Использование пакета DBMS_WARNING</h4></a></div><p>Пакет <code class="language-plsql">DBMS_WARNING</code> позволяет управлять поведением предупреждающих PL/SQL сообщений, в частности, путём чтения и изменения параметра инициализации <code class="language-plsql">PLSQL_WARNINGS</code> для управления тем, какие предупреждения подавляются, отображаются или рассматриваются как ошибки. Этот пакет предоставляет интерфейс для запроса, изменения и удаления текущих параметров системы или сеанса.</p></div><script src="./../js/prism.js"></script><script src="./../js/setup.js"></script><script src="./../js/main.js"></script><script src="./../js/synopsis.js"></script></body></html>